function AppointmentList(){this.pipeFn=function(){if(-1===window.location.href.indexOf("placeuserid"))return!1;var e=window.location.search;e=e.split("&")[1].split("=")[1];var t=$my.saleuserListID.querySelectorAll("li");Array.prototype.forEach.call(t,function(t){if(t.dataset.info===e){$(t).addClass("activeSelect").siblings("li").removeClass("activeSelect");var s=$(t).offset().left,n=$($my.saleuserListID).offset().left;$($my.saleuserListID).stop().animate({scrollLeft:s-n-8},500),s=null,n=null}})}}AppointmentList.prototype={throttle:function(e,t){clearTimeout(e.tId),e.tId=setTimeout(function(){e.call(t)},500)},touchThrottle:function(e,t,s){var n=null,i=new Date;return function(){var a=this,o=arguments,l=new Date;clearTimeout(n),l-i>=s?(e.apply(a,o),i=l):n=setTimeout(function(){e.apply(a,o)},t)}},renderSalesUserList:function(){if(-1==window.location.href.indexOf("PlaceUserLeader"))throw $my.loader_inner.hide(),$my.messageInfo.html("url错误").fadeIn("fast").delay("1000").fadeOut("slow"),new Error("url错误");var e=window.location.search;if(!(e=e.split("=")[1].split("&")[0]))throw $my.loader_inner.hide(),$my.messageInfo.html("组ID丢失").fadeIn("fast").delay("1000").fadeOut("slow"),new Error("组ID丢失");$my.PlaceUserLeader=e},renderSaleUser:function(e,t){var e=e.split(","),t=t.split(","),s="";if(!e.length||!t.length)return void $my.messageInfo.html("暂无组员信息").stop().fadeIn("fast").delay("1000").fadeOut("slow");for(var n=0;n<e.length;n++)s+="<li class='text-center' data-info="+e[n]+">"+t[n]+"</li>";$my.saleuserListID.innerHTML=s,$my.saleuserListID.firstChild.classList.add("activeSelect"),appointmentList.pipeFn()},renderEle:function(e){for(var t="",s=0;s<e.length;s++)t+='<div class="row" data-id='+e[s].id+'><div class="col-sm-6 col-xs-6 col-md-6"><div class="innerTop">',t+='<p class="bigFont"><span>'+e[s].houseName+"</span></p>",t+='</div><div class="innerBottom">',t+='<p class="colorGray nowrap">'+e[s].agencyName+"</p>",t+='</div></div><div class="col-sm-3 col-xs-3 col-md-3"><div class="innerTop"><p class="colorGray bigFont">&nbsp;</p></div><div class="innerBottom">',t+='<p class="colorGray text-center">佣:<span>'+(e[s].commissionAmount/1e4).toFixed(0)+"</span>万元</p>",t+='</div></div><div class="col-sm-3 col-xs-3 col-md-3 text-right"><div class="innerTop">',t+='<p class="colorGreen"><span>已发</span></p>',t+='</div><div class="innerBottom">',t+='<kbd class="bgcGray"><span>联</span>:<span>'+e[s].placeName+"</span></kbd>",t+="</div></div></div>";$($my.wrap).append(t),$my.flag=!1},getData:function(e,t,s,n,i){if(null==e||"null"==e)return $my.messageInfo.html("楼盘参数丢失").fadeIn("fast").delay("1000").fadeOut("slow"),!1;$.ajax({url:getRoothPath+"/placeusercontroller/commissionPlaceListApp.json",data:{propertyID:e,timeselete:t,PlaceUserLeader:s,placeUserID:n,pageNum:i},async:!1,success:function(e){if("{}"===JSON.stringify(e))return $my.loader_inner.hide(),void $my.messageInfo.html("暂无数据").stop().fadeIn("fast").delay("1000").fadeOut("slow");$my.pageSize=e.recordsTotal,$my.totalNum.innerHTML=e.recordsTotal,$my.sumCommssion.innerHTML=(e.sumCommssion/1e4).toFixed(0),s&&appointmentList.renderSaleUser(e.placeUserIDList,e.placeUserIDName);var t=e.data;if(!t.length)return $my.loader_inner.hide(),$my.messageInfo.html("暂无信息").stop().fadeIn("fast").delay("1000").fadeOut("slow"),!1;t.length<20&&($my.loader_inner.hide(),$my.lodingText.classList.add("lodingText_show")),appointmentList.renderEle(t)}})},scrollEvent:function(){var e=document.documentElement.clientHeight,t=$my.lodingText.parentNode,s=t.getBoundingClientRect(),n=$my.countType.querySelector(".optionListActive").dataset.index,i=$my.saleuserListID.querySelector(".activeSelect").dataset.info;if(!$my.flag){if(!(s.top<e&&s.bottom>=0))return;if($my.flag=!0,++$my.num>parseInt($my.pageSize/20)||$my.num==parseInt($my.pageSize/20)&&$my.pageSize%20==0)return $my.loader_inner.hide(),$my.lodingText.classList.add("lodingText_show"),!1;appointmentList.getData($my.propertyid,n,"",i,$my.num)}},buffer:function(){$my.lodingText.classList.remove("lodingText_show");var e=$my.countType.querySelector(".optionListActive").dataset.index,t=$my.saleuserListID.querySelector(".activeSelect").dataset.info;if(sessionStorage.setItem("globaltimeSelect",JSON.stringify(e)),sessionStorage.setItem("globalPeopleID",JSON.stringify(t)),"0"===e||"5"===e)return $my.messageInfo.html("今日/自定暂停查询").fadeIn("fast").delay("1000").fadeOut("slow"),$my.totalNum.innerHTML="",$my.sumCommssion.innerHTML="",$my.loader_inner.hide(),!1;$my.loader_inner.show(),appointmentList.getData($my.propertyid,e,"",t,0)},turnDetail:function(){var e=this.dataset.id;window.location.href="commission_detail.html?detailed="+e}};var appointmentList=new AppointmentList;$(function(){window.$my={messageInfo:$(".messageInfo"),propertyid:sessionStorage.getItem("propertyID"),num:0,wrap:document.querySelector("#wrap"),loader_inner:$(".loader-inner"),lodingText:document.querySelector(".lodingText"),countType:document.querySelector("#countType"),saleuserListID:document.querySelector("#saleuserListID"),totalNum:document.querySelector("#totalNum"),sumCommssion:document.querySelector("#sumCommssion"),flag:!1},$.ajaxSetup({type:"POST",dataType:"json",error:function(){$my.messageInfo.html("服务错误").fadeIn("fast").delay("1000").fadeOut("slow")}}),appointmentList.renderSalesUserList(),appointmentList.getData($my.propertyid,1,$my.PlaceUserLeader,"",0);var e=sessionStorage.getItem("globaltimeSelect"),t=sessionStorage.getItem("globalPeopleID");if(null!=e&&"null"!=e){e=JSON.parse(e);var s=$my.countType.querySelectorAll("li[data-index]");s=Array.prototype.slice.call(s);for(var n=0;n<s.length;n++)if(s[n].dataset.index===e){$(s[n]).addClass("optionListActive").siblings("li").removeClass("optionListActive");var i=$(s[n]).offset().left,a=$($my.countType).offset().left;$($my.countType).stop().animate({scrollLeft:i-a-8},500)}if(null!=t&&"null"!=t){t=JSON.parse(t);var o=$my.saleuserListID.querySelectorAll("li[data-info]");o=Array.prototype.slice.call(o);for(var n=0;n<o.length;n++)if(o[n].dataset.info===t){$(o[n]).addClass("activeSelect").siblings("li").removeClass("activeSelect");var i=$(o[n]).offset().left,a=$($my.saleuserListID).offset().left;$($my.saleuserListID).stop().animate({scrollLeft:i-a-8},500)}}else appointmentList.pipeFn();appointmentList.buffer()}var s=$my.countType.querySelectorAll("li");Array.prototype.forEach.call(s,function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("optionListActive").siblings("li").removeClass("optionListActive"),$my.num=0,$my.wrap.innerHTML="",appointmentList.throttle(appointmentList.buffer,this)},!1)}),$my.wrap.addEventListener("touchmove",appointmentList.touchThrottle(appointmentList.scrollEvent,500,1e3)),$($my.saleuserListID).on("click","li",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("activeSelect").siblings("li").removeClass("activeSelect"),$my.num=0,$my.wrap.innerHTML="",appointmentList.throttle(appointmentList.buffer,this)}),$($my.wrap).on("click",".row",function(e){e.preventDefault(),e.stopPropagation(),appointmentList.throttle(appointmentList.turnDetail,this)})});