function ReportList(){this.recordsTotal=""}ReportList.prototype={constructor:ReportList,throttle:function(e,t){clearTimeout(e.tId),e.tId=setTimeout(function(){e.call(t)},200)},touchThrottle:function(e,t,o){var r=null,n=new Date;return function(){var a=this,s=arguments,i=new Date;clearTimeout(r),i-n>=o?(e.apply(a,s),n=i):r=setTimeout(function(){e.apply(a,s)},t)}},getArguments:function(){if($my.propertyID=sessionStorage.getItem("propertyID"),-1==window.location.href.indexOf("lastName"))throw $my.messageInfo.html("url错误").fadeIn("fast").delay("1000").fadeOut("slow"),new Error("url错误");var e=window.location.search;e=e.split("=")[1],$my.lastName=e},bindDom:function(){document.querySelector("#recordsTotal").innerHTML=this.recordsTotal},getData:function(e,t,o){if(null==e||"null"==e)return $my.messageInfo.html("楼盘参数丢失").fadeIn("fast").delay("1000").fadeOut("slow"),!1;$.ajax({url:getRoothPath+"/overview/customerPerListApp.json",data:{PropertyID:e,lastName:t,pageNum:o},success:function(e){if("{}"===JSON.stringify(e))return $my.loader_inner.hide(),$my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;reportList.recordsTotal=e.recordsTotal,reportList.bindDom(),$my.pageSize=e.recordsTotal;var t=e.data;if(!t.length)return $my.loader_inner.hide(),$my.messageInfo.html("暂无信息").fadeIn("fast").delay("1000").fadeOut("slow"),!1;t.length<20&&($my.loader_inner.hide(),$my.lodingText.classList.add("lodingText_show")),reportList.renderEle(t)}})},renderEle:function(e){for(var t="",o=0;o<e.length;o++)t+='<div class="row" data-customerid='+e[o].customerID+">",t+='<div class="col-sm-8 col-xs-8 col-md-8">',t+='<div class="innerTop">',t+='<p class="bigFont"><span>'+e[o].customerName+"</span>　<span>"+e[o].customerPhone+"</span></p>",t+="</div>",t+='<div class="innerBottom">',t+='<p class="colorGray nowrap"><span>'+e[o].agencyName+"</span></p>",t+="</div>",t+="</div>",t+='<div class="col-sm-4 col-xs-4 col-md-4 text-right">',t+='<div class="innerTop">',t+='<p class="nowrap colorGray"><span class="colorGreen"><b>'+e[o].visitNum+"</b>访</span>&nbsp;&nbsp;<span>"+e[o].bbTime+"</span></p>",t+="</div>",t+='<div class="innerBottom">',t+='<kbd class="bgcGray"><span></span><span>'+e[o].memberName+"</span></kbd>",t+="</div></div></div>";$(wrap).append(t),$my.flag=!1},scrollEvent:function(){var e=document.documentElement.clientHeight,t=$my.lodingText.parentNode,o=t.getBoundingClientRect();if(!$my.flag){if(!(o.top<e&&o.bottom>=0))return;if($my.flag=!0,++$my.num>parseInt($my.pageSize/20)||$my.num==parseInt($my.pageSize/20)&&$my.pageSize%20==0)return $my.loader_inner.hide(),$my.lodingText.classList.add("lodingText_show"),!1;reportList.getData($my.propertyID,$my.lastName,$my.num)}},buffer:function(){var e=this.dataset.customerid;window.location.href="report_detail.html?customerid="+e}};var reportList=new ReportList;$(function(){window.$my={messageInfo:$(".messageInfo"),wrap:document.querySelector("#wrap"),loader_inner:$(".loader-inner"),lodingText:document.querySelector(".lodingText"),num:0,flag:!1},reportList.getArguments(),$.ajaxSetup({type:"POST",dataType:"json",error:function(){$my.messageInfo.html("服务错误").fadeIn("fast").delay("1000").fadeOut("slow")}}),reportList.getData($my.propertyID,$my.lastName,0),window.addEventListener("touchmove",reportList.touchThrottle(reportList.scrollEvent,500,1e3)),$($my.wrap).on("click",".row",function(e){e.preventDefault(),e.stopPropagation(),reportList.throttle(reportList.buffer,this)})});